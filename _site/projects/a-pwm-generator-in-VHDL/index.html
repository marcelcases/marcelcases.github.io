<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
    <link href="/styles.css" type="text/css" media="screen" rel="stylesheet">
    <link href="/print.css" type="text/css" media="print" rel="stylesheet">
    <script type="text/javascript" async="" src="https://platform.twitter.com/widgets.js"></script>
    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>A PWM generator in VHDL | Marcel Cases</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="A PWM generator in VHDL" />
<meta name="author" content="marcel" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Function The following VHDL code describes a PWM signal generator that works at an output frequency of approximately 1kHz and has a duty cycle that can be configured through the n-bit input port duty. VHDL code library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm is generic ( n : integer := 10; -- 1024 bit resolution eoc : integer := 99 ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end pwm; architecture behavioral of pwm is signal comptador : integer range 0 to 2**n-1; signal comptador_clk_div : integer range 0 to eoc; signal clk_div : std_logic ; begin proc_clk_div : process (clk) begin if rising_edge(clk) then clk_div &lt;= &#39;0&#39;; if reset = &#39;1&#39; then comptador_clk_div &lt;= 0; elsif comptador_clk_div = eoc then comptador_clk_div &lt;= 0; clk_div &lt;= &#39;1&#39;; else comptador_clk_div &lt;= comptador_clk_div + 1; end if; end if; end process; proc_comptador : process (clk_div) is begin if rising_edge(clk_div) then if reset = &#39;1&#39; then comptador &lt;= 0; elsif comptador = 2**n-2 then comptador &lt;= 0; else comptador &lt;= comptador + 1; end if; end if; end process; pwm_out &lt;= &#39;1&#39; when comptador &lt; to_integer(unsigned(duty)) else &#39;0&#39;; end behavioral; Testbench library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm_tb is generic ( n : integer := 10; eoc : integer := 99 ); end pwm_tb; architecture bench of pwm_tb is component pwm is generic ( n : integer; eoc : integer ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end component ; signal clk_tb : std_logic := &#39;0&#39;; signal reset_tb : std_logic := &#39;1&#39;; signal duty_tb : std_logic_vector (n-1 downto 0); signal pwm_out_tb : std_logic; begin uut: pwm generic map ( n =&gt; 10, eoc =&gt; 99 ) port map ( clk =&gt; clk_tb, reset =&gt; reset_tb, duty =&gt; duty_tb, pwm_out =&gt; pwm_out_tb ); clk_tb &lt;= not clk_tb after 5ns; --half_period reset_tb &lt;= &#39;0&#39; after 10ns; --duty_tb &lt;= b&quot;0000000000&quot;; -- 0% duty cycle duty_tb &lt;= b&quot;0111111111&quot;; -- 50% duty cycle --duty_tb &lt;= b&quot;1111111111&quot;; -- 100% duty cycle end bench;" />
<meta property="og:description" content="Function The following VHDL code describes a PWM signal generator that works at an output frequency of approximately 1kHz and has a duty cycle that can be configured through the n-bit input port duty. VHDL code library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm is generic ( n : integer := 10; -- 1024 bit resolution eoc : integer := 99 ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end pwm; architecture behavioral of pwm is signal comptador : integer range 0 to 2**n-1; signal comptador_clk_div : integer range 0 to eoc; signal clk_div : std_logic ; begin proc_clk_div : process (clk) begin if rising_edge(clk) then clk_div &lt;= &#39;0&#39;; if reset = &#39;1&#39; then comptador_clk_div &lt;= 0; elsif comptador_clk_div = eoc then comptador_clk_div &lt;= 0; clk_div &lt;= &#39;1&#39;; else comptador_clk_div &lt;= comptador_clk_div + 1; end if; end if; end process; proc_comptador : process (clk_div) is begin if rising_edge(clk_div) then if reset = &#39;1&#39; then comptador &lt;= 0; elsif comptador = 2**n-2 then comptador &lt;= 0; else comptador &lt;= comptador + 1; end if; end if; end process; pwm_out &lt;= &#39;1&#39; when comptador &lt; to_integer(unsigned(duty)) else &#39;0&#39;; end behavioral; Testbench library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm_tb is generic ( n : integer := 10; eoc : integer := 99 ); end pwm_tb; architecture bench of pwm_tb is component pwm is generic ( n : integer; eoc : integer ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end component ; signal clk_tb : std_logic := &#39;0&#39;; signal reset_tb : std_logic := &#39;1&#39;; signal duty_tb : std_logic_vector (n-1 downto 0); signal pwm_out_tb : std_logic; begin uut: pwm generic map ( n =&gt; 10, eoc =&gt; 99 ) port map ( clk =&gt; clk_tb, reset =&gt; reset_tb, duty =&gt; duty_tb, pwm_out =&gt; pwm_out_tb ); clk_tb &lt;= not clk_tb after 5ns; --half_period reset_tb &lt;= &#39;0&#39; after 10ns; --duty_tb &lt;= b&quot;0000000000&quot;; -- 0% duty cycle duty_tb &lt;= b&quot;0111111111&quot;; -- 50% duty cycle --duty_tb &lt;= b&quot;1111111111&quot;; -- 100% duty cycle end bench;" />
<link rel="canonical" href="http://localhost:4000/projects/a-pwm-generator-in-VHDL/" />
<meta property="og:url" content="http://localhost:4000/projects/a-pwm-generator-in-VHDL/" />
<meta property="og:site_name" content="Marcel Cases" />
<meta property="og:image" content="https://raw.githubusercontent.com/marcelcases/marcelcases.github.io/master/favicon/apple-icon-180x180.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-11-14T13:00:00+01:00" />
<script type="application/ld+json">
{"datePublished":"2018-11-14T13:00:00+01:00","@type":"BlogPosting","image":"https://raw.githubusercontent.com/marcelcases/marcelcases.github.io/master/favicon/apple-icon-180x180.png","url":"http://localhost:4000/projects/a-pwm-generator-in-VHDL/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/projects/a-pwm-generator-in-VHDL/"},"author":{"@type":"Person","name":"marcel"},"headline":"A PWM generator in VHDL","dateModified":"2018-11-14T13:00:00+01:00","description":"Function The following VHDL code describes a PWM signal generator that works at an output frequency of approximately 1kHz and has a duty cycle that can be configured through the n-bit input port duty. VHDL code library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm is generic ( n : integer := 10; -- 1024 bit resolution eoc : integer := 99 ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end pwm; architecture behavioral of pwm is signal comptador : integer range 0 to 2**n-1; signal comptador_clk_div : integer range 0 to eoc; signal clk_div : std_logic ; begin proc_clk_div : process (clk) begin if rising_edge(clk) then clk_div &lt;= &#39;0&#39;; if reset = &#39;1&#39; then comptador_clk_div &lt;= 0; elsif comptador_clk_div = eoc then comptador_clk_div &lt;= 0; clk_div &lt;= &#39;1&#39;; else comptador_clk_div &lt;= comptador_clk_div + 1; end if; end if; end process; proc_comptador : process (clk_div) is begin if rising_edge(clk_div) then if reset = &#39;1&#39; then comptador &lt;= 0; elsif comptador = 2**n-2 then comptador &lt;= 0; else comptador &lt;= comptador + 1; end if; end if; end process; pwm_out &lt;= &#39;1&#39; when comptador &lt; to_integer(unsigned(duty)) else &#39;0&#39;; end behavioral; Testbench library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm_tb is generic ( n : integer := 10; eoc : integer := 99 ); end pwm_tb; architecture bench of pwm_tb is component pwm is generic ( n : integer; eoc : integer ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end component ; signal clk_tb : std_logic := &#39;0&#39;; signal reset_tb : std_logic := &#39;1&#39;; signal duty_tb : std_logic_vector (n-1 downto 0); signal pwm_out_tb : std_logic; begin uut: pwm generic map ( n =&gt; 10, eoc =&gt; 99 ) port map ( clk =&gt; clk_tb, reset =&gt; reset_tb, duty =&gt; duty_tb, pwm_out =&gt; pwm_out_tb ); clk_tb &lt;= not clk_tb after 5ns; --half_period reset_tb &lt;= &#39;0&#39; after 10ns; --duty_tb &lt;= b&quot;0000000000&quot;; -- 0% duty cycle duty_tb &lt;= b&quot;0111111111&quot;; -- 50% duty cycle --duty_tb &lt;= b&quot;1111111111&quot;; -- 100% duty cycle end bench;","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed/atom.xml" title="Marcel Cases" />

    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-1959218-2']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
<!-- Begin Jekyll SEO tag v2.6.1 -->
<title>A PWM generator in VHDL | Marcel Cases</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="A PWM generator in VHDL" />
<meta name="author" content="marcel" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Function The following VHDL code describes a PWM signal generator that works at an output frequency of approximately 1kHz and has a duty cycle that can be configured through the n-bit input port duty. VHDL code library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm is generic ( n : integer := 10; -- 1024 bit resolution eoc : integer := 99 ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end pwm; architecture behavioral of pwm is signal comptador : integer range 0 to 2**n-1; signal comptador_clk_div : integer range 0 to eoc; signal clk_div : std_logic ; begin proc_clk_div : process (clk) begin if rising_edge(clk) then clk_div &lt;= &#39;0&#39;; if reset = &#39;1&#39; then comptador_clk_div &lt;= 0; elsif comptador_clk_div = eoc then comptador_clk_div &lt;= 0; clk_div &lt;= &#39;1&#39;; else comptador_clk_div &lt;= comptador_clk_div + 1; end if; end if; end process; proc_comptador : process (clk_div) is begin if rising_edge(clk_div) then if reset = &#39;1&#39; then comptador &lt;= 0; elsif comptador = 2**n-2 then comptador &lt;= 0; else comptador &lt;= comptador + 1; end if; end if; end process; pwm_out &lt;= &#39;1&#39; when comptador &lt; to_integer(unsigned(duty)) else &#39;0&#39;; end behavioral; Testbench library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm_tb is generic ( n : integer := 10; eoc : integer := 99 ); end pwm_tb; architecture bench of pwm_tb is component pwm is generic ( n : integer; eoc : integer ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end component ; signal clk_tb : std_logic := &#39;0&#39;; signal reset_tb : std_logic := &#39;1&#39;; signal duty_tb : std_logic_vector (n-1 downto 0); signal pwm_out_tb : std_logic; begin uut: pwm generic map ( n =&gt; 10, eoc =&gt; 99 ) port map ( clk =&gt; clk_tb, reset =&gt; reset_tb, duty =&gt; duty_tb, pwm_out =&gt; pwm_out_tb ); clk_tb &lt;= not clk_tb after 5ns; --half_period reset_tb &lt;= &#39;0&#39; after 10ns; --duty_tb &lt;= b&quot;0000000000&quot;; -- 0% duty cycle duty_tb &lt;= b&quot;0111111111&quot;; -- 50% duty cycle --duty_tb &lt;= b&quot;1111111111&quot;; -- 100% duty cycle end bench;" />
<meta property="og:description" content="Function The following VHDL code describes a PWM signal generator that works at an output frequency of approximately 1kHz and has a duty cycle that can be configured through the n-bit input port duty. VHDL code library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm is generic ( n : integer := 10; -- 1024 bit resolution eoc : integer := 99 ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end pwm; architecture behavioral of pwm is signal comptador : integer range 0 to 2**n-1; signal comptador_clk_div : integer range 0 to eoc; signal clk_div : std_logic ; begin proc_clk_div : process (clk) begin if rising_edge(clk) then clk_div &lt;= &#39;0&#39;; if reset = &#39;1&#39; then comptador_clk_div &lt;= 0; elsif comptador_clk_div = eoc then comptador_clk_div &lt;= 0; clk_div &lt;= &#39;1&#39;; else comptador_clk_div &lt;= comptador_clk_div + 1; end if; end if; end process; proc_comptador : process (clk_div) is begin if rising_edge(clk_div) then if reset = &#39;1&#39; then comptador &lt;= 0; elsif comptador = 2**n-2 then comptador &lt;= 0; else comptador &lt;= comptador + 1; end if; end if; end process; pwm_out &lt;= &#39;1&#39; when comptador &lt; to_integer(unsigned(duty)) else &#39;0&#39;; end behavioral; Testbench library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm_tb is generic ( n : integer := 10; eoc : integer := 99 ); end pwm_tb; architecture bench of pwm_tb is component pwm is generic ( n : integer; eoc : integer ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end component ; signal clk_tb : std_logic := &#39;0&#39;; signal reset_tb : std_logic := &#39;1&#39;; signal duty_tb : std_logic_vector (n-1 downto 0); signal pwm_out_tb : std_logic; begin uut: pwm generic map ( n =&gt; 10, eoc =&gt; 99 ) port map ( clk =&gt; clk_tb, reset =&gt; reset_tb, duty =&gt; duty_tb, pwm_out =&gt; pwm_out_tb ); clk_tb &lt;= not clk_tb after 5ns; --half_period reset_tb &lt;= &#39;0&#39; after 10ns; --duty_tb &lt;= b&quot;0000000000&quot;; -- 0% duty cycle duty_tb &lt;= b&quot;0111111111&quot;; -- 50% duty cycle --duty_tb &lt;= b&quot;1111111111&quot;; -- 100% duty cycle end bench;" />
<link rel="canonical" href="http://localhost:4000/projects/a-pwm-generator-in-VHDL/" />
<meta property="og:url" content="http://localhost:4000/projects/a-pwm-generator-in-VHDL/" />
<meta property="og:site_name" content="Marcel Cases" />
<meta property="og:image" content="https://raw.githubusercontent.com/marcelcases/marcelcases.github.io/master/favicon/apple-icon-180x180.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-11-14T13:00:00+01:00" />
<script type="application/ld+json">
{"datePublished":"2018-11-14T13:00:00+01:00","@type":"BlogPosting","image":"https://raw.githubusercontent.com/marcelcases/marcelcases.github.io/master/favicon/apple-icon-180x180.png","url":"http://localhost:4000/projects/a-pwm-generator-in-VHDL/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/projects/a-pwm-generator-in-VHDL/"},"author":{"@type":"Person","name":"marcel"},"headline":"A PWM generator in VHDL","dateModified":"2018-11-14T13:00:00+01:00","description":"Function The following VHDL code describes a PWM signal generator that works at an output frequency of approximately 1kHz and has a duty cycle that can be configured through the n-bit input port duty. VHDL code library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm is generic ( n : integer := 10; -- 1024 bit resolution eoc : integer := 99 ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end pwm; architecture behavioral of pwm is signal comptador : integer range 0 to 2**n-1; signal comptador_clk_div : integer range 0 to eoc; signal clk_div : std_logic ; begin proc_clk_div : process (clk) begin if rising_edge(clk) then clk_div &lt;= &#39;0&#39;; if reset = &#39;1&#39; then comptador_clk_div &lt;= 0; elsif comptador_clk_div = eoc then comptador_clk_div &lt;= 0; clk_div &lt;= &#39;1&#39;; else comptador_clk_div &lt;= comptador_clk_div + 1; end if; end if; end process; proc_comptador : process (clk_div) is begin if rising_edge(clk_div) then if reset = &#39;1&#39; then comptador &lt;= 0; elsif comptador = 2**n-2 then comptador &lt;= 0; else comptador &lt;= comptador + 1; end if; end if; end process; pwm_out &lt;= &#39;1&#39; when comptador &lt; to_integer(unsigned(duty)) else &#39;0&#39;; end behavioral; Testbench library ieee; use ieee.std_logic_1164.all; use ieee.numeric_std.all; entity pwm_tb is generic ( n : integer := 10; eoc : integer := 99 ); end pwm_tb; architecture bench of pwm_tb is component pwm is generic ( n : integer; eoc : integer ); port ( clk, reset : in std_logic; duty : in std_logic_vector (n-1 downto 0); pwm_out : out std_logic ); end component ; signal clk_tb : std_logic := &#39;0&#39;; signal reset_tb : std_logic := &#39;1&#39;; signal duty_tb : std_logic_vector (n-1 downto 0); signal pwm_out_tb : std_logic; begin uut: pwm generic map ( n =&gt; 10, eoc =&gt; 99 ) port map ( clk =&gt; clk_tb, reset =&gt; reset_tb, duty =&gt; duty_tb, pwm_out =&gt; pwm_out_tb ); clk_tb &lt;= not clk_tb after 5ns; --half_period reset_tb &lt;= &#39;0&#39; after 10ns; --duty_tb &lt;= b&quot;0000000000&quot;; -- 0% duty cycle duty_tb &lt;= b&quot;0111111111&quot;; -- 50% duty cycle --duty_tb &lt;= b&quot;1111111111&quot;; -- 100% duty cycle end bench;","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  </head>
  <body>
    <div id="wrapper">
        <nav>
    <a id="montserrat" href="/"><img src="/images/montserrat.svg" width="304" height="76" alt="Marcel Cases" /></a>

    <ul>
      <li><a href="/">Projects</a></li>
      <!--<li><a href="/projects/">Projects</a></li>-->
      <li><a href="/about">About</a></li>
      <li><a href="/contact">Contact</a></li>
    </ul>
  </nav>

      <main>
<!-- Begin Content -->
        <article>
          <header>
            <h2>
              <b><a href="/projects/a-pwm-generator-in-VHDL/" rel="bookmark">A PWM generator in VHDL</a></b>
            </h2>
            <p>
              Posted by <span class="vcard"><span class="fn">marcel</span></span>,
              <span class="published" title="2018-11-14 13:00:00 +0100">November 14, 2018 @  1:00 pm</span>
              
                <span class="categories">in
              
              
                <a href="/projects/" rel="category tag">Projects</a>
              
              
              </span>
              
            </p>
          </header>
          <section>
<!-- Begin Post -->
<h2 id="function">Function</h2>
<p>The following VHDL code describes a <strong>PWM signal generator</strong> that works at an output frequency of approximately 1kHz and has a duty cycle that can be configured through the n-bit input port <em>duty</em>.</p>

<h2 id="vhdl-code">VHDL code</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library ieee;
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;


entity pwm is
    generic (   n : integer := 10; -- 1024 bit resolution
                eoc : integer := 99
                );
    port (  clk, reset : in std_logic;
            duty : in std_logic_vector (n-1 downto 0);
            pwm_out : out std_logic
            );
end pwm;

architecture behavioral of pwm is
    signal comptador : integer range 0 to 2**n-1;
    signal comptador_clk_div : integer range 0 to eoc;
    signal clk_div : std_logic ;

begin

proc_clk_div : process (clk) begin
    if rising_edge(clk) then
        clk_div &lt;= '0';
        if reset = '1' then
            comptador_clk_div &lt;= 0;
        elsif comptador_clk_div = eoc then
            comptador_clk_div &lt;= 0;
            clk_div &lt;= '1';
        else comptador_clk_div &lt;= comptador_clk_div + 1;
        end if;
    end if;
end process;

proc_comptador : process (clk_div) is begin
    if rising_edge(clk_div) then
        if reset = '1' then
            comptador &lt;= 0;
        elsif comptador = 2**n-2 then
            comptador &lt;= 0;
        else
            comptador &lt;= comptador + 1;
        end if;
    end if;
end process;

pwm_out &lt;= '1' when comptador &lt; to_integer(unsigned(duty)) else '0';

end behavioral;
</code></pre></div></div>

<h2 id="testbench">Testbench</h2>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>library ieee; 
use ieee.std_logic_1164.all;
use ieee.numeric_std.all;


entity pwm_tb is
    generic (   n : integer := 10;
                eoc : integer := 99
                );
end pwm_tb;

architecture bench of pwm_tb is
    component  pwm is
        generic (   n : integer;
                    eoc : integer
                    );
        port (  clk, reset : in std_logic;
                duty : in std_logic_vector (n-1 downto 0);
                pwm_out : out std_logic
                );
    end component ;

    signal clk_tb : std_logic := '0';
    signal reset_tb : std_logic := '1';
    signal duty_tb : std_logic_vector (n-1 downto 0);
    signal pwm_out_tb : std_logic;
        
begin

uut: pwm
    generic map (   n =&gt; 10,
                    eoc =&gt; 99
                    )
    port map (  clk =&gt; clk_tb,
                reset =&gt; reset_tb,
                duty =&gt; duty_tb,
                pwm_out =&gt; pwm_out_tb
                );

clk_tb &lt;= not clk_tb after 5ns; --half_period
reset_tb &lt;= '0' after 10ns;
--duty_tb &lt;= b"0000000000"; -- 0% duty cycle
duty_tb &lt;= b"0111111111"; -- 50% duty cycle
--duty_tb &lt;= b"1111111111"; -- 100% duty cycle

end bench;
</code></pre></div></div>

<!-- End Post -->
          </section>
        </article>
<!-- End Content -->
      </main>
    </div>
    
    <style>
  h6 {
    font-weight: normal;
  }
</style>

<span class='notbold'><center><h6><p>&copy; 2020 Marcel Cases<p></h6></center></span>

    
  </body>
</html>
